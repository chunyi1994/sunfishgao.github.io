# 三分钟掌握终生受用的网络键值对原理(未完成)

# 键值对网络缓存
键值对缓存目前常用的是两个，Memcached以及Redis。由于这类缓存存取数据的速度很快，因此通常用来提高网络服务的性能。不怎么使用Memcached，所以本文以Redis为主。

## 多数据结构支持
Redis支持的数据结构很多。由于c语言标准库并没有那么丰富的容器使用，所以作者造了大量的轮子。string ，list，有序set，无序set，哈希表等等。对象都有引用计数。

## 数据的存储
Redis是个键值对存储程序，所以所有的数据都以key-value的方式存在内存中。key就是Redis里的字符串sds。value都用一个结构体表示，结构体里用void*指针来存放真正的数据结构，并且有一个type变量表示是什么数据类型，像极了C++的多态。

## 支持过期键
并不是所有的键都需要定时删除的功能，所以过期时间放在value的结构体里是不合适的，因为会有浪费。比较好的方法是别处再新开一个map，key还是原来的key，value存过期时间戳。

## 过期数据的删除策略
不被采纳的两种方式:
1.为每一个含有过期时间的键开启一个定时器，这样做最省事，但是性能不太好。
2.定时扫描全部的数据，删除全部过期数据。

认为可靠的方式:
3.当用户用到了某个键以后再做检查，即"惰性删除"。
4.每隔一段时间随机扫描几个，删除过期键。

3+4两个策略同时进行，就能保证用户不会拿到已过期的数据，又能很好解决"stop the world"时间过长的问题。

持久化


